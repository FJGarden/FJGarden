<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finn’s Foundation – Giraffe Conservation</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {--primary:#D2691E;--accent:#FFD700;--success:#228B22;--bg:#f9f9f9;}
        *{box-sizing:border-box;}
        body{font-family:'Poppins',sans-serif;margin:0;background:var(--bg);color:#333;text-align:center;}
        header{background:var(--primary);color:white;padding:20px;font-family:'Fredoka One',cursive;}
        .container{max-width:900px;margin:auto;padding:20px;}

        /* EMBEDDED SAVANNA BACKGROUND (SVG) */
        .giraffe-container{
            height:300px;position:relative;margin:30px 0;
            background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 300"><defs><linearGradient id="sky" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%2387CEEB"/><stop offset="100%" stop-color="%23E0F7FA"/></linearGradient><linearGradient id="ground" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="%23D2691E"/><stop offset="100%" stop-color="%23F4A460"/></linearGradient></defs><rect width="800" height="200" fill="url(%23sky)"/><rect y="200" width="800" height="100" fill="url(%23ground)"/><circle cx="700" cy="80" r="40" fill="%23FFD700"/><path d="M100,220 Q120,210 140,220 T180,220" fill="none" stroke="%234CAF50" stroke-width="8"/><path d="M300,220 Q320,210 340,220 T380,220" fill="none" stroke="%234CAF50" stroke-width="8"/><path d="M500,220 Q520,210 540,220 T580,220" fill="none" stroke="%234CAF50" stroke-width="8"/></svg>') bottom center no-repeat;
            background-size:contain;
        }

        /* EMBEDDED GIRAFFE (SVG) */
        #giraffe{
            position:absolute;bottom:0;left:50%;transform:translateX(-50%);
            width:120px;height:120px;transition:height 1.2s ease,bottom 1.2s ease;
            background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 150"><path d="M50,10 Q45,5 40,10 Q35,5 30,10 L30,30 Q25,35 25,45 L20,70 Q15,80 20,90 L25,110 Q30,130 35,140 Q40,145 50,140 Q60,145 65,140 Q70,130 75,110 L80,90 Q85,80 80,70 L75,45 Q75,35 70,30 L70,10 Q65,5 60,10 Q55,5 50,10 Z" fill="%23D2691E"/><circle cx="40" cy="20" r="8" fill="%23000"/><circle cx="60" cy="20" r="8" fill="%23000"/><circle cx="40" cy="20" r="3" fill="%23FFF"/><circle cx="60" cy="20" r="3" fill="%23FFF"/><path d="M35,35 Q40,40 45,35" fill="none" stroke="%23000" stroke-width="2"/><path d="M55,35 Q60,40 65,35" fill="none" stroke="%23000" stroke-width="2"/><rect x="38" y="45" width="24" height="15" rx="3" fill="%23FFF"/><path d="M40,50 L45,55 L60,50" fill="none" stroke="%23D2691E" stroke-width="2"/><ellipse cx="35" cy="75" rx="8" ry="12" fill="%238B4513"/><ellipse cx="65" cy="75" rx="8" ry="12" fill="%238B4513"/><ellipse cx="35" cy="100" rx="10" ry="15" fill="%23D2691E"/><ellipse cx="65" cy="100" rx="10" ry="15" fill="%23D2691E"/></svg>') center/contain no-repeat;
        }

        .goal-box{background:white;padding:20px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1);margin:20px 0;}
        .goal-bar{height:30px;background:#eee;border-radius:15px;overflow:hidden;margin:15px 0;}
        .goal-fill{height:100%;width:0%;background:linear-gradient(90deg,#FFD700,#FFA500);transition:width 1s ease;}
        .goal-text{font-size:1.5em;font-weight:600;}
        .live-badge{background:#ff0000;color:white;padding:4px 10px;border-radius:20px;font-size:0.8em;animation:pulse 2s infinite;}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}

        .leaderboard{background:white;padding:20px;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,0.1);margin:25px 0;}
        table{width:100%;border-collapse:collapse;}
        th,td{padding:10px;text-align:left;border-bottom:1px solid #eee;}
        th{background:#f0f0f0;font-weight:600;}
        .rank-1{background:#FFD700 !important;}
        .rank-2{background:#C0C0C0 !important;}
        .rank-3{background:#CD7F32 !important;}
        .perk-unlocked{background:#90EE90 !important;}

        .profile-gallery{
            display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:15px;margin:30px 0;
            justify-items:center;
        }
        .profile-card{
            background:white;padding:12px;border-radius:18px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
            text-align:center;font-size:0.9em;width:130px;
        }
        .profile-img{
            width:80px;height:80px;border-radius:50%;border:5px solid #ddd;
            background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 150"><path d="M50,10 Q45,5 40,10 Q35,5 30,10 L30,30 Q25,35 25,45 L20,70 Q15,80 20,90 L25,110 Q30,130 35,140 Q40,145 50,140 Q60,145 65,140 Q70,130 75,110 L80,90 Q85,80 80,70 L75,45 Q75,35 70,30 L70,10 Q65,5 60,10 Q55,5 50,10 Z" fill="%23D2691E"/><circle cx="40" cy="20" r="8" fill="%23000"/><circle cx="60" cy="20" r="8" fill="%23000"/><circle cx="40" cy="20" r="3" fill="%23FFF"/><circle cx="60" cy="20" r="3" fill="%23FFF"/><path d="M35,35 Q40,40 45,35" fill="none" stroke="%23000" stroke-width="2"/><path d="M55,35 Q60,40 65,35" fill="none" stroke="%23000" stroke-width="2"/><rect x="38" y="45" width="24" height="15" rx="3" fill="%23FFF"/><path d="M40,50 L45,55 L60,50" fill="none" stroke="%23D2691E" stroke-width="2"/><ellipse cx="35" cy="75" rx="8" ry="12" fill="%238B4513"/><ellipse cx="65" cy="75" rx="8" ry="12" fill="%238B4513"/><ellipse cx="35" cy="100" rx="10" ry="15" fill="%23D2691E"/><ellipse cx="65" cy="100" rx="10" ry="15" fill="%23D2691E"/></svg>') center/contain no-repeat;
            background-color:#f9f9f9;margin:0 auto 8px;
        }
        .profile-img.gold{border-color:#FFD700 !important;}
        .profile-name{font-weight:600;font-size:1em;}
        .profile-amount{color:var(--success);font-weight:bold;}
        .profile-title{font-size:0.75em;color:#666;margin-top:2px;}
        .download-btn{
            margin-top:8px;padding:6px 10px;font-size:0.7em;background:var(--success);color:white;
            border:none;border-radius:8px;cursor:pointer;transition:0.2s;
        }
        .download-btn:hover{background:#1a6b1a;transform:scale(1.05);}

        .donate-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin:20px 0;}
        .donate-btn{padding:15px;font-size:1.1em;font-weight:bold;color:white;border:none;border-radius:12px;cursor:pointer;transition:transform .2s,box-shadow .2s;}
        .donate-btn:hover{transform:scale(1.05);box-shadow:0 5px 15px rgba(0,0,0,0.2);}
        .btn-sdz{background:#1E90FF;}.btn-ld{background:#32CD32;}.btn-gcf{background:#FF4500;}

        #factPopup{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#333;color:white;padding:15px 25px;border-radius:50px;font-weight:bold;opacity:0;transition:opacity .5s;z-index:100;box-shadow:0 4px 10px rgba(0,0,0,0.3);}
        footer{margin-top:50px;font-size:0.9em;color:#666;}
        .fallback{background:#fff3cd;color:#856404;padding:15px;border-radius:10px;margin:20px 0;font-style:italic;}

        @media (max-width:600px){#giraffe{width:90px;height:90px;}.donate-grid{grid-template-columns:1fr;}}
    </style>
</head>
<body>

<header>
    <h1>Finn’s Foundation</h1>
    <p>Saving Giraffes, One Donation at a Time | <span class="live-badge">LIVE</span> Goal: <strong>$500</strong></p>
</header>

<div class="container">

    <div class="giraffe-container">
        <div id="giraffe"></div>
    </div>

    <div class="goal-box">
        <div class="goal-text" id="goalText">$0 / $500</div>
        <div class="goal-bar"><div class="goal-fill" id="goalFill"></div></div>
        <p><em>Auto-updates every 10 seconds from Google Sheets!</em></p>
    </div>

    <div id="fallback" class="fallback" style="display:none;">
        No donations yet — be the first to help Finn’s Foundation!
    </div>

    <div class="leaderboard">
        <h3>Donor Profile Pics – $75+ Perk! (Click to Download)</h3>
        <div class="profile-gallery" id="profileGallery"></div>
    </div>

    <div class="leaderboard">
        <h3>Top Donors – Finn’s Foundation</h3>
        <table id="leaderboardTable">
            <thead><tr><th>Rank</th><th>Name</th><th>Amount</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="donate-grid">
        <button class="donate-btn btn-sdz" onclick="donateTo('https://donate.sandiegozoo.org/')">San Diego Zoo</button>
        <button class="donate-btn btn-ld" onclick="donateTo('https://shop.livingdesert.org/products/giraffe-adoption')">Living Desert Adopt</button>
        <button class="donate-btn btn-gcf" onclick="donateTo('https://give.giraffeconservation.org/')">GCF USA</button>
    </div>

    <div style="margin:30px 0;background:white;padding:15px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);">
        <h2>Live from California</h2>
        <iframe src="https://www.youtube.com/embed/A0mU_o4Xz2g" title="San Diego Zoo Giraffe Cam" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="width:100%;height:400px;border:none;border-radius:8px;"></iframe>
    </div>

</div>

<div id="factPopup"></div>

<footer>
    <p><strong>Finn’s Foundation</strong> | Powered by Google Sheets | <a href="mailto:finn@foundation.com">Contact</a> | #FinnsFoundation</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<audio id="cheer" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" preload="auto"></audio>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSMd_mMkf3dCKlMxMiBe0nr5s9UcxIBa4dvRxxgBYab1Gh_OR4fXudHMhLyMNmpWDkfRgMd8oYsxGIf/pub?output=csv';
const GOAL = 500;
let raised = 0, lastMilestone = 0, donors = [];

const giraffe = document.getElementById('giraffe');
const fill = document.getElementById('goalFill');
const text = document.getElementById('goalText');
const tbody = document.querySelector('#leaderboardTable tbody');
const gallery = document.getElementById('profileGallery');
const popup = document.getElementById('factPopup');
const cheer = document.getElementById('cheer');
const fallback = document.getElementById('fallback');

const facts = ["Giraffes have blue tongues to prevent sunburn!", "A giraffe's neck is 6 feet long but has only 7 vertebrae!", "They can run 35 mph – faster than most horses!", "Baby giraffes are born 6 feet tall!", "Giraffes only need 30 minutes of sleep per day!"];

async function fetchData() {
    try {
        const response = await fetch(CSV_URL + '?t=' + Date.now());
        const csv = await response.text();
        const lines = csv.trim().split('\n');
        donors = [];
        for (let i = 1; i < lines.length; i++) {
            const cols = lines[i].split(',');
            if (cols.length >= 3) {
                const amount = parseFloat(cols[2]);
                const name = cols[1]?.trim();
                if (name && !isNaN(amount)) donors.push({ name, amount });
            }
        }
        calculateTotalAndUpdate();
    } catch (e) {
        console.error("Fetch failed:", e);
        fallback.textContent = "Could not load donations. Check your internet or Google Sheet link.";
        fallback.style.display = "block";
    }
}

function calculateTotalAndUpdate() {
    raised = donors.reduce((sum, d) => sum + d.amount, 0);
    updateGoal();
    updateLeaderboard();
    updateProfileGallery();
    fallback.style.display = donors.length === 0 ? "block" : "none";
}

function updateGoal() {
    const percent = Math.min((raised / GOAL) * 100, 100);
    fill.style.width = percent + '%';
    text.innerHTML = `$${raised.toLocaleString()} / $${GOAL.toLocaleString()}`;
    const maxHeight = 280;
    const growth = (raised / GOAL) * maxHeight;
    giraffe.style.height = (120 + growth) + 'px';
    giraffe.style.bottom = growth + 'px';

    const milestone = Math.floor(raised / 100) * 100;
    if (milestone > lastMilestone && milestone > 0) {
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        cheer.play();
        showFact();
        lastMilestone = milestone;
    }
    if (raised >= GOAL && !window.celebrated) {
        confetti({ particleCount: 200, spread: 100, origin: { y: 0.5 } });
        text.innerHTML += ' <span style="color:#FFD700;">GOAL SMASHED!</span>';
        window.celebrated = true;
    }
}

function updateLeaderboard() {
    const sorted = [...donors].sort((a, b) => b.amount - a.amount);
    tbody.innerHTML = '';
    sorted.forEach((d, i) => {
        const row = document.createElement('tr');
        if (i === 0) row.classList.add('rank-1');
        else if (i === 1) row.classList.add('rank-2');
        else if (i === 2) row.classList.add('rank-3');
        if (d.amount >= 75) row.classList.add('perk-unlocked');
        row.innerHTML = `<td><strong>#${i + 1}</strong></td><td>${d.name}</td><td>$${d.amount.toLocaleString()}</td>`;
        tbody.appendChild(row);
    });
}

function updateProfileGallery() {
    gallery.innerHTML = '';
    const eligible = donors.filter(d => d.amount >= 75);
    eligible.forEach(d => {
        const card = document.createElement('div');
        card.className = 'profile-card';
        const isGold = d.amount >= 100;
        card.innerHTML = `
            <div class="profile-img ${isGold ? 'gold' : ''}"></div>
            <div class="profile-name">${d.name}</div>
            <div class="profile-amount">$${d.amount}</div>
            <div class="profile-title">Finn’s Guardian</div>
            <button class="download-btn" onclick="downloadPic(this)">Download</button>
        `;
        gallery.appendChild(card);
    });
}

function downloadPic(btn) {
    const card = btn.parentElement;
    html2canvas(card, { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = `finns-foundation-${card.querySelector('.profile-name').textContent}.png`;
        link.href = canvas.toDataURL();
        link.click();
    });
}

function showFact() {
    const fact = facts[Math.floor(Math.random() * facts.length)];
    popup.textContent = fact;
    popup.style.opacity = 1;
    setTimeout(() => { popup.style.opacity = 0; }, 4000);
}

function donateTo(url) { window.open(url, '_blank'); }

fetchData();
setInterval(fetchData, 10000);
</script>

</body>
</html>